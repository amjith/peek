<!DOCTYPE html>
<html>
  <head>
    <title>Peek Results</title>
    <script type="text/javascript" src="jquery-1.7.1.min.js"></script>
    <script type="text/javascript">
    var Peek = (function(){
        var self = this;

        this.data = {};

        this.load = function(data){

            self.data = data;

            self.render(data);
        };

        this.render = function(data){
            var $results = $('#results');
            $results.empty();

            self.renderRow($results, null, data);

            // $results.Treeview({ speed: "fast", collapsed: true, control: "#treecontrol" });
        };

        this.renderRow = function($el, parent, data){
            var $parent = $('<table></table>');
            var had_any = false;
            $.each(data, function(key, value){
                had_any = true;
                var label = value.s;
                if (label == '') {
                    label = '&nbsp;';
                }
                var timing = ((Math.round((value.t / value.n) * 1000, 5) / 1000) || 0);
                var $row = $('<tr><td class="t">' + timing + 's</td><td class="l">' + value.l + '</td><td class="c"><pre>' + label + '</pre></tr>');
                $parent.append($row);

                self.renderRow($row.find('td:last-child'), value, value.c);
            });
            if (had_any) {
                $el.append($parent);
            }
        };

        return this;
    })();
    </script>
    <style type="text/css">
    body {
        font-size: 11px;
    }
    * {
        line-height: 15px;
        padding: 0;
        margin: 0;
    }
    li {
        margin-left: 10px;
    }
    pre {
        font-family: monaco, fixed;
        font-size: inherit;
        padding: 0;
    }
    table {
        border-left: 1px solid #ddd;
        border-spacing: collapse;
    }
    td {
        padding: 0 2px;
        background: #fff;
        vertical-align: top;
        font-family: monaco, fixed;
    }
    td.t, td.l {
        padding-right: 10px;
        text-align: right;
    }
    td.c {
        color: #555;
        text-align: left;
    }
    </style>
  </head>
  <body>
    <ol id="results"></ol>
    <script type="text/javascript" src="data.json"></script>
  </body>
</html>